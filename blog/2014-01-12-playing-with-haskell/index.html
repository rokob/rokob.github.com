<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.78 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:300;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2.2974rem;line-height:2.67rem;letter-spacing:-2px;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}ul{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:0.85rem;line-height:1.78rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1rem;line-height:1.78rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}blockquote{margin-left:0;margin-right:1.78rem;margin-top:0;padding-bottom:0;padding-left:1.44625rem;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1.1487rem;line-height:1.78rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.33375rem solid hsla(0,0%,0%,0.2);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.78rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.78rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}li > ul{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.78rem / 2);}code{font-size:0.85rem;line-height:1.78rem;}kbd{font-size:0.85rem;line-height:1.78rem;}samp{font-size:0.85rem;line-height:1.78rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.18667rem;padding-right:1.18667rem;padding-top:0.89rem;padding-bottom:calc(0.89rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#4b0082;text-decoration:none;}a:hover,a:active{text-decoration:underline;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.78rem;color:hsla(0,0%,0%,0.9);font-weight:300;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.78rem;}blockquote{margin-left:-1.335rem;margin-right:0;padding-left:1.00125rem;}}@media only screen and (max-width:768px){h1{font-size:2rem;line-height:2.67rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.56rem;}</style><meta name="generator" content="Gatsby 5.14.1"/><meta name="description" content="Personal site of Andy Weiss" data-gatsby-head="true"/><meta name="image" content="https://rokob.github.io/favicon-32x32.png" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="rokob :: Playing with Haskell" data-gatsby-head="true"/><meta name="twitter:url" content="https://rokob.github.io/blog/2014-01-12-playing-with-haskell/" data-gatsby-head="true"/><meta name="twitter:description" content="Personal site of Andy Weiss" data-gatsby-head="true"/><meta name="twitter:image" content="https://rokob.github.io/favicon-32x32.png" data-gatsby-head="true"/><meta name="twitter:creator" content="@dragonb3ar" data-gatsby-head="true"/><style data-href="/styles.f21535414e15f8faeffd.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}.gatsby-highlight-code-line{background-color:#feb;border-left:.25em solid #f99;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:1em}.gatsby-highlight{background-color:#272822;border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.8em}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link href="//fonts.googleapis.com/css?family=Open+Sans:700|Merriweather:300,300i,700,700i" rel="stylesheet" type="text/css"/><title data-gatsby-head="true">rokob :: Playing with Haskell</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 1snke1a">.css-1snke1a{margin:0 auto;max-width:800px;padding-bottom:3.56rem;padding-top:2.67rem;}@media only screen and (max-width: 801px){.css-1snke1a{width:93%;}}</style><div class="css-1snke1a erleo414"><a href="/"><style data-emotion="css 1w8900m">.css-1w8900m{margin-top:0;margin-bottom:1.78rem;display:inline-block;font-style:normal;}</style><h3 class="css-1w8900m erleo412">rokob</h3></a><style data-emotion="css tjo4qw">.css-tjo4qw{float:right;}</style><div class="css-tjo4qw erleo411"><style data-emotion="css 13y4rum">.css-13y4rum{padding-left:0.89rem;}</style><a class="css-13y4rum erleo410" href="/reading/">Reading</a><a class="css-13y4rum erleo410" href="/about/">About</a></div><style data-emotion="css 198bgkg">.css-198bgkg{margin-top:3.56rem;}</style><div class="css-198bgkg erleo413"><style data-emotion="css dfkuil">.css-dfkuil{margin-bottom:0.89rem;}</style><h2 class="css-dfkuil e13a1ij53">Playing with Haskell</h2><style data-emotion="css 1f6tha0">.css-1f6tha0{margin-top:0.89rem;margin-bottom:1.78rem;color:#bbb;}</style><h3 class="css-1f6tha0 e13a1ij52">12 Jan 2014</h3><style data-emotion="css k4kvhd">.css-k4kvhd{margin-top:3.56rem;margin-bottom:1.78rem;color:inherit;}</style><div class="css-k4kvhd e13a1ij51"><style data-emotion="css k8h3ik">.css-k8h3ik{margin-top:0.89rem;margin-bottom:0.445rem;}</style><h4 class="css-k8h3ik e13a1ij50">Category: <!-- -->code</h4><h4 class="css-k8h3ik e13a1ij50"><a href="/tags/">Tags:</a> <a href="/tags/haskell/">haskell</a>, <a href="/tags/moving/">moving</a></h4></div><style data-emotion="css 1aujq9w">.css-1aujq9w{text-align:justify;}</style><div class="css-1aujq9w e13a1ij54"><p>Before I get in to the coding part of this post I figured I would talk a little
bit about what is going on because I have not posted in a little over a week.
Nothing too crazy has happend lately, although we did go see one apartment
place, Lauren liked it a lot, I also liked it, so we are moving next weekend.
We are going to pay pretty close to the same rent (which is way too high still)
but get 2 bedrooms and 2 bathrooms instead of 1 bedroom and 1 bathroom. We will
also be in walking distance of Lauren's work which will dramatically change our
commuting situation. Right now we end up having to coordinate using our car and
when we go to and from work because I am often lazy and don't feel like riding
my bike. This new situation will allow her to walk and me to walk to the train
station if I am feeling lazy, so no more annoying coordination. We will also be
getting tv again and legitimate internet which will be a huge win. The downside
is that we have to go through the moving process which is always just terrible.
We are getting pretty good at it considering this will be each of our roughly
tenth place. We went through all of our stuff today and threw out 10+ garbage
bags worth of random crap and clothes we don't wear anymore. The troubling part
being the place does not look that much different. It is amazing how easy it is
to accumulate crap, I know I will continue to accumulate it most likely, but it
is good to clean things up now and then. I will be more willing to do this type
of cleaning in the future because it felt good to unburden myself from a lot of
junk. Now, on to the code.</p>
<p>I have been getting back into Haskell again recently and for whatever reason I
like it a lot more this time around. I have always been much happier coding in
functional languages, but I have spent most of that time working with Erlang
which is basically untyped whereas Haskell is strongly typed. I don't think I
really appreciated the benefits of such a full featured type system until I
spent a lot of time working in Objective-C. If you have ever spent time trying
to prevent shooting yourself in the foot in Obj-C then you know what I am
talking about.</p>
<p>Interestingly enough I have been working on a side project that involves both
languages. I have been prototyping the concept of generating Obj-C with Haskell
to make a lot of the boilerplate that goes into creating an app less annoying,
but more importantly making it declarative and statically verified. Anyway, I
have been spending some time playing around with parsing in Haskell, which
leads to <a href="http://legacy.cs.uu.nl/daan/parsec.html">Parsec</a>. Just for fun, I wrote a little parser for JSON just
to get my feet wet.</p>
<p>I am going to walk through it because there is only a small amount of code
which is pretty interesting. First the preamble because I hate reading code on
blogs which isn't easy to get running.</p>
<div class="gatsby-highlight" data-language="haskell"><pre class="language-haskell"><code class="language-haskell"><span class="token import-statement"><span class="token keyword">import</span> Control<span class="token punctuation">.</span>Applicative <span class="token keyword">hiding</span></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&lt;|></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">many</span><span class="token punctuation">)</span>
<span class="token import-statement"><span class="token keyword">import</span> Text<span class="token punctuation">.</span>ParserCombinators<span class="token punctuation">.</span>Parsec</span>
<span class="token import-statement"><span class="token keyword">import</span> Text<span class="token punctuation">.</span>ParserCombinators<span class="token punctuation">.</span>Parsec<span class="token punctuation">.</span>Language</span> <span class="token punctuation">(</span><span class="token hvariable">haskellDef</span><span class="token punctuation">)</span>
<span class="token import-statement"><span class="token keyword">import</span> <span class="token keyword">qualified</span> Text<span class="token punctuation">.</span>ParserCombinators<span class="token punctuation">.</span>Parsec<span class="token punctuation">.</span>Token <span class="token keyword">as</span> P</span>

<span class="token hvariable">lexer</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>makeTokenParser</span> <span class="token hvariable">haskellDef</span>
<span class="token hvariable">brackets</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>brackets</span> <span class="token hvariable">lexer</span>
<span class="token hvariable">braces</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>braces</span> <span class="token hvariable">lexer</span>
<span class="token hvariable">stringLit</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>stringLiteral</span> <span class="token hvariable">lexer</span>
<span class="token hvariable">naturalOrFloat</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>naturalOrFloat</span> <span class="token hvariable">lexer</span>
<span class="token hvariable">commaSep</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>commaSep</span> <span class="token hvariable">lexer</span>
<span class="token hvariable">symbol</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>symbol</span> <span class="token hvariable">lexer</span>
<span class="token hvariable">colon</span> <span class="token operator">=</span> <span class="token hvariable">P<span class="token punctuation">.</span>colon</span> <span class="token hvariable">lexer</span></code></pre></div>
<p>These are some pretty standard imports, and then we define some simple parsers
at the top level of this module that we will use to build up the parser.</p>
<p>The entry point into the parser we will call <code class="language-text">json</code> and which will recognize
the two top level types that make up the json spec:</p>
<div class="gatsby-highlight" data-language="haskell"><pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">json</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
<span class="token hvariable">json</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">object</span> <span class="token operator">&lt;|></span> <span class="token hvariable">array</span><span class="token punctuation">)</span> <span class="token operator">&lt;*</span> <span class="token hvariable">eof</span></code></pre></div>
<p>Okay so this makes a little less sense if you know what is going on here. We
are defining a parser which returns an <code class="language-text">Integer</code> because for fun I am going to
make this thing sum up all of the numbers that show up in the input. This is
just because we have to do something meaningful, but I don't really feel like
doing too much more with it. So with that in mind, let's go through what is
going on here. JSON is either an object or an array. We need the <code class="language-text">&lt;* eof</code> to
say basically that we want to parse all of the input and fail if there is any
trailing characters that do not properly parse. So basically
<code class="language-text">{"key":1},[1,2,3]</code> should not parse as valid, but without the extra bit it
would parse just ignorning the <code class="language-text">,[1,2,3]</code>. Ok well what is an object?</p>
<div class="gatsby-highlight" data-language="haskell"><pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">object</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
<span class="token hvariable">object</span> <span class="token operator">=</span> <span class="token hvariable">summedListOfStuff</span> <span class="token hvariable">braces</span> <span class="token hvariable">keyValue</span> <span class="token operator">&lt;?></span> <span class="token string">"object"</span>

<span class="token hvariable">summedListOfStuff</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">CharParser</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token constant">Integer</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">-></span> <span class="token constant">CharParser</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token constant">Integer</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                  <span class="token operator">-></span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
                  <span class="token operator">-></span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
<span class="token hvariable">summedListOfStuff</span> <span class="token hvariable">f</span> <span class="token hvariable">v</span> <span class="token operator">=</span>
  <span class="token keyword">do</span>
    <span class="token hvariable">vs</span> <span class="token operator">&lt;-</span> <span class="token hvariable">f</span> <span class="token operator">.</span> <span class="token hvariable">commaSep</span> <span class="token operator">$</span> <span class="token punctuation">(</span><span class="token hvariable">many1</span> <span class="token hvariable">v</span><span class="token punctuation">)</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token builtin">sum</span> <span class="token operator">.</span> <span class="token builtin">concat</span> <span class="token operator">$</span> <span class="token hvariable">vs</span><span class="token punctuation">)</span></code></pre></div>
<p>An object is key-value pairs between a set of braces, and because we are trying
to sum up the numbers we find we use an auxiliary function to create a parser
that does just that when given the outer delimeters and a parser. It turns out
that array is very similar</p>
<div class="gatsby-highlight" data-language="haskell"><pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">array</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
<span class="token hvariable">array</span> <span class="token operator">=</span> <span class="token hvariable">summedListOfStuff</span> <span class="token hvariable">brackets</span> <span class="token hvariable">value</span> <span class="token operator">&lt;?></span> <span class="token string">"array"</span></code></pre></div>
<p>Basically the same thing just instead of braces we have brackets and instead of
key-value pairs we just have values. This highlights the declarative nature of
combinator parsers where you just describe what something is and out comes a
parser that does what you want. So as long as we define what a key-value pair
is and what a value is then we are done.</p>
<div class="gatsby-highlight" data-language="haskell"><pre class="language-haskell"><code class="language-haskell"><span class="token hvariable">keyValue</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
<span class="token hvariable">keyValue</span> <span class="token operator">=</span> <span class="token hvariable">stringLit</span> <span class="token operator">>>=</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">_</span> <span class="token operator">-></span> <span class="token hvariable">colon</span> <span class="token operator">>>=</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">_</span> <span class="token operator">-></span> <span class="token hvariable">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;?></span> <span class="token string">"key-value pair"</span>

<span class="token hvariable">value</span> <span class="token operator">::</span> <span class="token constant">Parser</span> <span class="token constant">Integer</span>
<span class="token hvariable">value</span> <span class="token operator">=</span>
  <span class="token keyword">do</span>
    <span class="token hvariable">try</span> <span class="token hvariable">stringLit</span>
    <span class="token builtin">return</span> <span class="token number">0</span>
  <span class="token operator">&lt;|></span> <span class="token keyword">do</span>
    <span class="token hvariable">e</span> <span class="token operator">&lt;-</span> <span class="token hvariable">naturalOrFloat</span>
    <span class="token keyword">case</span> <span class="token hvariable">e</span> <span class="token keyword">of</span>
      <span class="token constant">Left</span>  <span class="token hvariable">i</span> <span class="token operator">-></span> <span class="token builtin">return</span> <span class="token hvariable">i</span>
      <span class="token constant">Right</span> <span class="token hvariable">f</span> <span class="token operator">-></span> <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token builtin">truncate</span> <span class="token hvariable">f</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;|></span> <span class="token keyword">do</span>
    <span class="token hvariable">symbol</span> <span class="token string">"true"</span>
    <span class="token builtin">return</span> <span class="token number">1</span>
  <span class="token operator">&lt;|></span> <span class="token keyword">do</span>
    <span class="token hvariable">symbol</span> <span class="token string">"false"</span>
    <span class="token builtin">return</span> <span class="token number">0</span>
  <span class="token operator">&lt;|></span> <span class="token keyword">do</span>
    <span class="token hvariable">symbol</span> <span class="token string">"null"</span>
    <span class="token builtin">return</span> <span class="token number">0</span>
  <span class="token operator">&lt;|></span> <span class="token hvariable">try</span> <span class="token hvariable">array</span>
  <span class="token operator">&lt;|></span> <span class="token hvariable">object</span>
  <span class="token operator">&lt;?></span> <span class="token string">"value"</span></code></pre></div>
<p>So for key-value pairs I was playing around with using bind instead of the do
syntax, you can just ignore that. A key-value pair is a string literal followed
by a colon followed by a value, pretty clear from the definition that is what
is going on.</p>
<p>Then what is a value? Well, it is a string, a number, an array, an object, or
one of the literals: <code class="language-text">true</code>, <code class="language-text">false</code>, or <code class="language-text">null</code>. This is where we get the
actual integers that we end up summing up. I decided to make strings, <code class="language-text">false</code>,
and <code class="language-text">null</code> equal to zero, <code class="language-text">true</code> equal to one, integers equal to themselves,
and to truncate floats. In the end this allows us to reduce the whole JSON
object to a single integer.</p>
<p>Technically this parser does not
parse to the exact spec. For instance <code class="language-text">stringLiteral</code> will not match strings with
unicode code points of the form \uXXXX directly in the string. This would not
be too difficult to fix but I don't particularly care for this toy. Also
naturalOrFloat does not exactly match the number type in the spec but again
whatever.</p>
<p>This gets us to the following in GHCi:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">λ> parse json "" "[1,2,3]"
Right 6
λ> parse json "" "{\"key\":[1,3,5],\"keyz\":[{\"arrKey\":10}, 1, 4],\"whoa\":null}"
Right 24
λ> parse json "" "{\"key\":1},{}"
Left (line 1, column 10):
unexpected ','
expecting end of input</code></pre></div></div><div><a href="https://github.com/rokob/rokob.github.com/commits/source/content/2014-01-12-playing-with-haskell.md">History</a> -- <a href="https://github.com/rokob/rokob.github.com/commit/9a9b8cc9a846a5ab6c26cb187880f3092ad02345">9a9b8cc9</a></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2014-01-12-playing-with-haskell/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-74d18815dd077486fe4c.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-12d390c00676b5f95045.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-71025402633be68d9d62.js\"],\"component---src-pages-reading-js\":[\"/component---src-pages-reading-js-cd120a53bb526792f88c.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-551bcba74b82c97580b2.js\"],\"component---src-templates-blog-list-js\":[\"/component---src-templates-blog-list-js-4922d9da0b6024e3d157.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-24e2de5845dfd5db0fc0.js\"],\"component---src-templates-tag-js\":[\"/component---src-templates-tag-js-195017f3819c4f1a843c.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="28e259d4c394b6f54b8e";</script><script src="/webpack-runtime-6f516ec0fd1bbce05065.js" async></script><script src="/framework-b0d0d270dbf692bac4b7.js" async></script><script src="/app-74d18815dd077486fe4c.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>