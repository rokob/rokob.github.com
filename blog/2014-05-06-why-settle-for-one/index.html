<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.78 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:300;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2.2974rem;line-height:2.67rem;letter-spacing:-2px;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}ul{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:0.85rem;line-height:1.78rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1rem;line-height:1.78rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}blockquote{margin-left:0;margin-right:1.78rem;margin-top:0;padding-bottom:0;padding-left:1.44625rem;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1.1487rem;line-height:1.78rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.33375rem solid hsla(0,0%,0%,0.2);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.78rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.78rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}li > ul{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.78rem / 2);}code{font-size:0.85rem;line-height:1.78rem;}kbd{font-size:0.85rem;line-height:1.78rem;}samp{font-size:0.85rem;line-height:1.78rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.18667rem;padding-right:1.18667rem;padding-top:0.89rem;padding-bottom:calc(0.89rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#4b0082;text-decoration:none;}a:hover,a:active{text-decoration:underline;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.78rem;color:hsla(0,0%,0%,0.9);font-weight:300;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.78rem;}blockquote{margin-left:-1.335rem;margin-right:0;padding-left:1.00125rem;}}@media only screen and (max-width:768px){h1{font-size:2rem;line-height:2.67rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.56rem;}</style><meta name="generator" content="Gatsby 5.14.1"/><meta name="description" content="Personal site of Andy Weiss" data-gatsby-head="true"/><meta name="image" content="https://rokob.github.io/favicon-32x32.png" data-gatsby-head="true"/><meta name="twitter:card" content="summary_large_image" data-gatsby-head="true"/><meta name="twitter:title" content="rokob :: Why settle for one ugly API when you can have two?" data-gatsby-head="true"/><meta name="twitter:url" content="https://rokob.github.io/blog/2014-05-06-why-settle-for-one/" data-gatsby-head="true"/><meta name="twitter:description" content="Personal site of Andy Weiss" data-gatsby-head="true"/><meta name="twitter:image" content="https://rokob.github.io/favicon-32x32.png" data-gatsby-head="true"/><meta name="twitter:creator" content="@dragonb3ar" data-gatsby-head="true"/><style data-href="/styles.f21535414e15f8faeffd.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}.gatsby-highlight-code-line{background-color:#feb;border-left:.25em solid #f99;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:1em}.gatsby-highlight{background-color:#272822;border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.8em}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link href="//fonts.googleapis.com/css?family=Open+Sans:700|Merriweather:300,300i,700,700i" rel="stylesheet" type="text/css"/><title data-gatsby-head="true">rokob :: Why settle for one ugly API when you can have two?</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 1snke1a">.css-1snke1a{margin:0 auto;max-width:800px;padding-bottom:3.56rem;padding-top:2.67rem;}@media only screen and (max-width: 801px){.css-1snke1a{width:93%;}}</style><div class="css-1snke1a erleo414"><a href="/"><style data-emotion="css 1w8900m">.css-1w8900m{margin-top:0;margin-bottom:1.78rem;display:inline-block;font-style:normal;}</style><h3 class="css-1w8900m erleo412">rokob</h3></a><style data-emotion="css tjo4qw">.css-tjo4qw{float:right;}</style><div class="css-tjo4qw erleo411"><style data-emotion="css 13y4rum">.css-13y4rum{padding-left:0.89rem;}</style><a class="css-13y4rum erleo410" href="/reading/">Reading</a><a class="css-13y4rum erleo410" href="/about/">About</a></div><style data-emotion="css 198bgkg">.css-198bgkg{margin-top:3.56rem;}</style><div class="css-198bgkg erleo413"><style data-emotion="css dfkuil">.css-dfkuil{margin-bottom:0.89rem;}</style><h2 class="css-dfkuil e13a1ij53">Why settle for one ugly API when you can have two?</h2><style data-emotion="css 1f6tha0">.css-1f6tha0{margin-top:0.89rem;margin-bottom:1.78rem;color:#bbb;}</style><h3 class="css-1f6tha0 e13a1ij52">06 May 2014</h3><style data-emotion="css k4kvhd">.css-k4kvhd{margin-top:3.56rem;margin-bottom:1.78rem;color:inherit;}</style><div class="css-k4kvhd e13a1ij51"><style data-emotion="css k8h3ik">.css-k8h3ik{margin-top:0.89rem;margin-bottom:0.445rem;}</style><h4 class="css-k8h3ik e13a1ij50">Category: <!-- -->code</h4><h4 class="css-k8h3ik e13a1ij50"><a href="/tags/">Tags:</a> <a href="/tags/ruby/">ruby</a>, <a href="/tags/code/">code</a>, <a href="/tags/api/">api</a></h4></div><style data-emotion="css 1aujq9w">.css-1aujq9w{text-align:justify;}</style><div class="css-1aujq9w e13a1ij54"><p>In my new job I am working exclusively in Ruby at the moment. What that means for this blog is that most of
the code I talk about will be in related to Ruby. I actually have found Ruby to be a beautiful language
as OO languages go. One of the things that has really blown me away is how similar Objective-C and Ruby are.
It is not that much of a surprise once one takes a step back and thinks about the design of the languages,
but Ruby wins in almost every regard from a design perspective. I don't really want to talk about that today
though, I have plans for a series of posts comparing different patterns in the two languages. This is going
to be a Ruby post though.</p>
<p>I was working on a problem where I needed to use <a href="https://github.com/sparklemotion/mechanize">Mechanize</a> to script filling out a form. Actually,
I have 50 subtly different forms that need to be filled out at different times. Fifty should remind you of the
number of states in the US so you might see the domain where this comes from. Anywho, Mechanize has an alright
API for interacting with an individual page or form on a page, but like any general tool, it does not present
the ideal API for my specific purpose. One approach is to just use the raw API directly in the place that you
need it and hope that you don't need to use something similar anywhere else. This is probably the way to go
if you cannot imagine replacing the lower level API (Mechanize in this case) with any other library or if
the semantics are basically the same between your desired use and what API is already presented.</p>
<p>My case involved violations of both of these conditions. The first condition is violated because I know for
a fact that I will need to use <a href="https://github.com/jnicklas/capybara">Capybara</a> for a small subset of the sites I am interacting with
because of their use of Javascript. For the second condition, I wanted to have a method like
<code class="language-text">check_radio_button(form, data)</code> where <code class="language-text">form</code> is some representation of the form on which the radio button
lives and <code class="language-text">data</code> is sufficient information to select a single radio button. Mechanize presents an API that
lets you find a radio button and check the button, but these are two method calls. The gain from moving to
one call isn't huge, but the real benefit is semantics. My API is more clear about what it is doing, and not
only that, I don't care how it is doing it, I just know that a radio button is getting checked. I have a need
for other related behaviours that take even more effort using the Mechanize API.</p>
<p>Okay, so I am convinced that I need to wrap the given API with my own. It is important to actually think about
this point though before just wrapping the API. When someone creates an API, they put some thought into it
(hopefully), they think about how people are going to use it, and they ideally iterate on it as the API is
used over time. Your wrapper is likely to be as shitty if not shittier because you are just quickly trying to
use the thing that someone else has already thought a lot about. Maybe you have a flash of inspiration and you
come up with the perfect API for a particular use case, but that never happens. Realize that you are usually
trading a shitty general API For a shitty idiosyncratic API. In my case that is kinda what I want, but YMMV.</p>
<p>I read <a href="http://pragprog.com/book/ppmetr/metaprogramming-ruby">Metaprogramming Ruby</a> when I realized that I would be working in Ruby soon because I'm a
sucker for esoteric language features. I remembered there being a discussion in there about using <code class="language-text">instance_eval</code>
to allow you to use an API without having to call a function directly on an object because of the implicit self
in Ruby. I used this idea to clean up the API wrapper that I eventually came up, but I had to go one step
further because I needed to pass an argument into my block to really make this wrapper shine.</p>
<p>I have a service object, which is some low level library that has an API that already solves some problem I have.
It also has some kind of type of object that it will yield to you. That object is what you actually are going
to interact with.</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Service</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">with_object</span></span><span class="token punctuation">(</span>criteria<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token class-name">ServiceType</span><span class="token punctuation">.</span><span class="token keyword">new</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">ServiceType</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">alpha</span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token number">1</span> <span class="token operator">+</span> a
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">beta</span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token number">2</span> <span class="token operator">+</span> a
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">gamma</span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token number">3</span> <span class="token operator">+</span> a
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>The traditional way of using this API would just be to do:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby">service <span class="token operator">=</span> <span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'some config'</span></span><span class="token punctuation">)</span>
service<span class="token punctuation">.</span>with_object<span class="token punctuation">(</span><span class="token symbol">a</span><span class="token operator">:</span> <span class="token string-literal"><span class="token string">'something'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>obj<span class="token operator">|</span>
  obj<span class="token punctuation">.</span>alpha<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span>beta<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
  obj<span class="token punctuation">.</span>gamma<span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">)</span>
<span class="token keyword">end</span></code></pre></div>
<p>That doesn't look so bad, but think about if calling <code class="language-text">alpha</code> then <code class="language-text">beta</code> in that
order meant to do something specific that has a particular meaning to you. Then
wrapping up some of these calls into your own interface would be nice:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Interface</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">add</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
    obj<span class="token punctuation">.</span>alpha<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>gamma<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">times</span></span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
    obj<span class="token punctuation">.</span>beta<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> obj<span class="token punctuation">.</span>beta<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">interact_with</span></span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token operator">&amp;</span>block<span class="token punctuation">)</span>
    <span class="token comment"># keep reading</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>This is the interface you want to expose, whatever it means, it takes the service
object as an input and possibly some other parameters and does whatever you need.
Why does it takes the service object as an input? You could actually stash the
service object in an ivar because of where we get it as you will see later, but
I prefer this because it makes this interface pure. That is, you can test these
with no work because they are pure functions.</p>
<p>Now I am going to skip over that one method stub and just show you how you use this:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Worker</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">do_work</span></span>
    <span class="token class-name">Interface</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span>interact_with<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'config data'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>obj<span class="token operator">|</span>
      x <span class="token operator">=</span> add<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
      times<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

puts <span class="token class-name">Worker</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span>do_work</code></pre></div>
<p>We have another class that uses this interface. I wrote it as a class just to wrap
this up into something self contained, but there is no need for that. Basically,
you call <code class="language-text">interact_with</code> with your configuration data and then use a block
to use your new interface. Inside this object you can call instance methods on
your interface class without specifying an instance. You are yielded the service
object so you can pass it through to the pure functions you have defined. How do
we accomplish this?</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Interface</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">interact_with</span></span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token operator">&amp;</span>block<span class="token punctuation">)</span>
    <span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">.</span>with_object <span class="token keyword">do</span> <span class="token operator">|</span>obj<span class="token operator">|</span>
      instance_exec obj<span class="token punctuation">,</span> <span class="token operator">&amp;</span>block
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>It is really simple in the end. You just use <code class="language-text">instance_exec</code> which allows you to
execute <code class="language-text">block</code> in the context of the <code class="language-text">Interface</code> class and pass the <code class="language-text">obj</code> as
a variable to the block.</p>
<p>You can "clean" this up a bit if you don't care about pure functions:</p>
<div class="gatsby-highlight" data-language="ruby"><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Interface</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">add</span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token variable">@obj</span><span class="token punctuation">.</span>alpha<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token variable">@obj</span><span class="token punctuation">.</span>gamma<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">times</span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token variable">@obj</span><span class="token punctuation">.</span>beta<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token variable">@obj</span><span class="token punctuation">.</span>beta<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">interact_with</span></span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token operator">&amp;</span>block<span class="token punctuation">)</span>
    <span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">.</span>with_object <span class="token keyword">do</span> <span class="token operator">|</span>obj<span class="token operator">|</span>
      <span class="token variable">@obj</span> <span class="token operator">=</span> obj
      instance_eval <span class="token operator">&amp;</span>block
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">class</span> <span class="token class-name">Worker</span>
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">do_work</span></span>
    <span class="token class-name">Interface</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">.</span>interact_with<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'config data'</span></span><span class="token punctuation">)</span> <span class="token keyword">do</span>
      x <span class="token operator">=</span> add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      times<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div>
<p>It probably depends on the specific problem which version makes sense. I just threw
this together today when I was trying to get my Mechanize wrapper to be easier to
use. I am not 100% yet whether this is a good pattern, or if the use of <code class="language-text">instance_exec</code>
is a good use of magic or not in this situation. I guess time will tell with this
one, but I had a good time playing around with Ruby to get this working.</p></div><div><a href="https://github.com/rokob/rokob.github.com/commits/source/content/2014-05-06-why-settle-for-one.md">History</a> -- <a href="https://github.com/rokob/rokob.github.com/commit/9a9b8cc9a846a5ab6c26cb187880f3092ad02345">9a9b8cc9</a></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2014-05-06-why-settle-for-one/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-74d18815dd077486fe4c.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-12d390c00676b5f95045.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-71025402633be68d9d62.js\"],\"component---src-pages-reading-js\":[\"/component---src-pages-reading-js-cd120a53bb526792f88c.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-551bcba74b82c97580b2.js\"],\"component---src-templates-blog-list-js\":[\"/component---src-templates-blog-list-js-4922d9da0b6024e3d157.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-24e2de5845dfd5db0fc0.js\"],\"component---src-templates-tag-js\":[\"/component---src-templates-tag-js-195017f3819c4f1a843c.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="28e259d4c394b6f54b8e";</script><script src="/webpack-runtime-6f516ec0fd1bbce05065.js" async></script><script src="/framework-b0d0d270dbf692bac4b7.js" async></script><script src="/app-74d18815dd077486fe4c.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>