{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2013-12-30-the-new-blog/","result":{"data":{"markdownRemark":{"html":"<p>Two years ago I said that I was going to blog every single day as my New Year's\nresolution. I managed 168 days and then nothing but silence. I am not really\nsure why I just stopped so suddenly, one possibility being that I used to use\nthe commute home to do my writing, and my last entry was the day we moved out\nof San Francisco which altered my commute considerably. Whatever the reason, I\nhave not written for the past 18 months or so and that is too bad. The reason I\nwanted to write every day was so that I could look back and see how I was\nfeeling or what I was thinking about during certain periods of time without\nhaving to try and remember. The last 18 months have been decently crazy and it\nwould have been really nice to see my thoughts during that time.</p>\n<p>I also really wish I had access to those 168 posts but that is partially the\nstory for this new set-up. I got an email from Webfaction, my hosting provider,\ntelling me that the machine that my site was dying and thus they were going to\nmigrate me to a new server. They were telling me because this meant that the IP\naddress for my A record would need to be updated, but they said all of my data\nwould be moved over without me having to do anything. As it turns out, when I\nfinally got around to checking in on the new machine and changing my A record,\nI noticed that all of my files were gone. The directory structure was all\nthere, but just no files. Weird. The code was backed up because I have it in a\nprivate Bitbucket repo, but what was not backed up was the CouchDB files where\nmy blog posts were stored. So I sent an email to Webfaction asking about this\nand seeing if they could restore my data from their backups. Here is their\nresponse:</p>\n<blockquote>\n<p>I am sorry but we were not able to recover your files from our backup system.\nOur system only keeps up to 10 days of backups and since it has been over 30\ndays there is no way to recover your files.</p>\n<p>Regarding backups, we do make daily backups, but we do not guarantee their availability.\nSometimes problems with the backup servers can prevent backups from being made\nsuccessfully. Like all reputable web hosts, we do recommend to all our customers that\nthey make their own backups independent of ours for any mission-critical data that they\ncannot afford to lose.</p>\n</blockquote>\n<p>Well that is just clowny. I understand it I guess, but still it is ridiculous\nfor a hosting provider to blow away all your files and then not be able to\nrecover them from their backups. Yes I should have backed up my DB but I never\ngot around to it so I have to pay the price for that.</p>\n<p>I also tried to rely on the <a href=\"https://archive.org/web/\">Wayback Machine</a> and Google caches to try\nto restore my blog posts, but I only managed to get 3 out of the 168. I will be putting\nthose up here soon and back dating them, they are all stupid, but what the hell.\nI actually wrote a tiny script to scrape the Wayback Machine which is how I got\nthe 3, but it did not have archives for anything else.</p>\n<p>All this led me to the decision to get off\nWebfaction and try something new. I also decided to try to incorporate the\nbackup of my posts in a natural way. This led me to <a href=\"http://pages.github.com/\">Github Pages</a>\nand <a href=\"http://jekyllrb.com\">Jekyll</a>. I considered going to Hakyll route which I read about <a href=\"http://blaenkdenum.com/posts/the-switch-to-hakyll/\">here</a>,\nbut in the end I decided to take some of the ideas from <a href=\"https://github.com/blaenk/blaenk.github.io/\">blaenk's</a> set-up\nand just mix it in with Jekyll. In particular, I have this blog set-up using\nGithub pages with two different branches, <code class=\"language-text\">master</code> and <code class=\"language-text\">source</code>. The <code class=\"language-text\">source</code>\nbranch has all of the actual code and content that Jekyll needs to create\nthis site, whereas the <code class=\"language-text\">master</code> branch just has the generated output. I use a\nshell script to run Jekyll, perform a commit, and push the new content to\nthe right branch. This was copied directly from the aforementioned site.</p>\n<p>One interesting thing that he did which I wanted to copy was to leverage\nthe fact that I am using <code class=\"language-text\">git</code> to have an automatic way of tracking the\nhistory of each post. On his site he used a single commit hash for\nevery single post when he was using Jekyll because it requires you to regeneate everything\nevery time. One nice think about Hakyll is that you only need to recompile\nwhat has changed, so it is easy to get a git commit hash for each post\nthat only changes when the past actually changes. I wanted the best of both\nworlds so I modified his commit plugin to the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">module</span> <span class=\"token class-name\">Jekyll</span>\n  <span class=\"token keyword\">class</span> <span class=\"token class-name\">Commit</span> <span class=\"token operator\">&lt;</span> Liquid<span class=\"token double-colon punctuation\">::</span>Tag\n    <span class=\"token constant\">MATCHER</span> <span class=\"token operator\">=</span> <span class=\"token regex-literal\"><span class=\"token regex\">/\\A(\\S+)\\Z/</span></span>\n    <span class=\"token keyword\">def</span> <span class=\"token method-definition\"><span class=\"token function\">render</span></span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n      markup <span class=\"token operator\">=</span> <span class=\"token variable\">@markup</span><span class=\"token punctuation\">.</span>strip\n \n      page_file <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">context<span class=\"token punctuation\">.</span>registers<span class=\"token punctuation\">[</span><span class=\"token symbol\">:site</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>source</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n      file_path <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">context<span class=\"token punctuation\">.</span>environments<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"page\"</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"path\"</span></span><span class=\"token punctuation\">]</span></span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n      page_file <span class=\"token operator\">+=</span> <span class=\"token string-literal\"><span class=\"token string\">\"/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">file_path</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n \n      sha <span class=\"token operator\">=</span> <span class=\"token command-literal\"><span class=\"token command string\">`git log -n 1 --pretty=format:%H -- </span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">page_file</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token command string\">`</span></span>\n      message <span class=\"token operator\">=</span> <span class=\"token command-literal\"><span class=\"token command string\">`git log -n 1 --pretty=format:%s -- </span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">page_file</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token command string\">`</span></span>\n \n      history_url <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"&lt;a href='https://github.com/rokob/rokob.github.com/commits/source/\"</span></span>\n      history_url <span class=\"token operator\">+=</span> file_path\n      history_url <span class=\"token operator\">+=</span> <span class=\"token string-literal\"><span class=\"token string\">\"'>History&lt;/a>\"</span></span>\n \n      commit_url <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"&lt;span class='commit' title=\\\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">message</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\\\">\"</span></span>\n      <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> markup<span class=\"token punctuation\">.</span>empty<span class=\"token operator\">?</span>\n        repo <span class=\"token operator\">=</span> markup<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">(</span><span class=\"token constant\">MATCHER</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        commit_url <span class=\"token operator\">+=</span> <span class=\"token string-literal\"><span class=\"token string\">\"&lt;a href=\\\"https://github.com/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">repo</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">/commit/</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">sha</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\\\"\"</span></span>\n        commit_url <span class=\"token operator\">+=</span> <span class=\"token string-literal\"><span class=\"token string\">\" title=\\\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">message</span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\\\"></span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">sha<span class=\"token punctuation\">[</span><span class=\"token number\">0.</span><span class=\"token punctuation\">.</span><span class=\"token number\">.8</span><span class=\"token punctuation\">]</span></span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">&lt;/a>\"</span></span>\n      <span class=\"token keyword\">else</span>\n        commit_url <span class=\"token operator\">+=</span> <span class=\"token string-literal\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token delimiter punctuation\">#{</span><span class=\"token content\">sha<span class=\"token punctuation\">[</span><span class=\"token number\">0.</span><span class=\"token punctuation\">.</span><span class=\"token number\">.8</span><span class=\"token punctuation\">]</span></span><span class=\"token delimiter punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n      <span class=\"token keyword\">end</span>\n      commit_url <span class=\"token operator\">+=</span> <span class=\"token string-literal\"><span class=\"token string\">\"&lt;/span>\"</span></span>\n \n      history_url <span class=\"token operator\">+</span> <span class=\"token string-literal\"><span class=\"token string\">\" -- \"</span></span> <span class=\"token operator\">+</span> commit_url\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n<span class=\"token keyword\">end</span>\n \nLiquid<span class=\"token double-colon punctuation\">::</span>Template<span class=\"token punctuation\">.</span>register_tag<span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">'commit'</span></span><span class=\"token punctuation\">,</span> Jekyll<span class=\"token double-colon punctuation\">::</span>Commit<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The trick here is that I used the fact that <code class=\"language-text\">git log</code> can tell you the last\ncommit when a particular file changed, which is exactly what I want. I just\nhave to do some trickeration with the <code class=\"language-text\">context</code> variable that is passed in\nto get a file path for the current post, but after that it is pretty much\nthe same as his original plugin.</p>\n<p>Jekyll is a pretty nice tool, I can't imagine I would outgrow it for quite some\ntime (where outgrow would mean generate too many pages to make the static site\nunwieldy or desparately need server side logic).</p>\n<p>I am going to try to post on here more frequently and not try to force myself\ninto writing everyday which will ultimately lead me to want to stop writing\nif I miss too many times. I already have some ideas for a few posts that will\nbe meant to fill in the gaps of what I have been up to for the past 18 months,\nand then probably some even more boring stuff.</p>","frontmatter":{"title":"The New Blog","date":"30 Dec 2013","categories":"update","tags":["blog","jekyll"]},"timeToRead":4,"wordCount":{"words":998},"fields":{"sha":"9a9b8cc9a846a5ab6c26cb187880f3092ad02345"},"parent":{"relativePath":"2013-12-30-the-new-blog.md"}}},"pageContext":{"slug":"/blog/2013-12-30-the-new-blog/"}},"staticQueryHashes":["3159585216","3192915761"],"slicesMap":{}}